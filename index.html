<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SmartCore Technology</title>
  <meta name="theme-color" content="#060916" />

  <style>
    :root{
      --bg0:#040612;
      --bg1:#07112a;
      --bg2:#0a1e46;

      --ink:rgba(245,248,255,.96);
      --muted:rgba(245,248,255,.74);
      --muted2:rgba(245,248,255,.55);

      --line:rgba(255,255,255,.12);
      --line2:rgba(255,255,255,.18);

      --glassA: rgba(18, 26, 56, .52);
      --glassB: rgba(12, 18, 42, .32);
      --glassC: rgba(255,255,255,.06);

      --accent: rgba(120, 195, 255, 1);
      --accent2: rgba(120,195,255,.55);

      --good:#35d07f;
      --warn:#ffbf3b;
      --bad:#ff5b6a;

      --shadow: 0 30px 100px rgba(0,0,0,.58);
      --shadow2: 0 14px 40px rgba(0,0,0,.45);

      --r1: 20px;
      --r2: 16px;

      --max: 1120px;
      --focus: 0 0 0 3px rgba(120,195,255,.22);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
      color:var(--ink);
      background:
        radial-gradient(900px 520px at 50% 18%, rgba(120,195,255,.22), transparent 64%),
        radial-gradient(1100px 760px at 18% 82%, rgba(120,195,255,.12), transparent 60%),
        radial-gradient(1100px 760px at 86% 80%, rgba(120,195,255,.10), transparent 62%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 40%, var(--bg0) 100%);
      overflow-x:hidden;
    }

    a{color:inherit; text-decoration:none}
    button{font:inherit}
    input,select,textarea{font:inherit}

    .container{width:min(var(--max), calc(100% - 40px)); margin:0 auto}

    /* Apple-ish glass panel */
    .glass{
      border:1px solid var(--line);
      border-radius: var(--r1);
      background:
        radial-gradient(1200px 260px at 30% 0%, rgba(255,255,255,.10), transparent 55%),
        radial-gradient(900px 240px at 100% 40%, rgba(120,195,255,.08), transparent 60%),
        linear-gradient(180deg, var(--glassA), var(--glassB));
      backdrop-filter: blur(22px) saturate(140%);
      -webkit-backdrop-filter: blur(22px) saturate(140%);
      box-shadow: var(--shadow2);
      position:relative;
      overflow:hidden;
    }
    .glass::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        linear-gradient(180deg, rgba(255,255,255,.10), transparent 35%),
        radial-gradient(700px 240px at 20% 0%, rgba(255,255,255,.09), transparent 60%);
      pointer-events:none;
      mix-blend-mode: screen;
      opacity:.55;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:11px 14px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(260px 120px at 20% 0%, rgba(255,255,255,.10), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      color:var(--ink);
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, border-color .2s ease, opacity .2s ease;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.20)}
    .btn:active{transform: translateY(0)}
    .btn:focus{outline:none; box-shadow: var(--focus)}
    .btn[disabled]{opacity:.55; cursor:not-allowed; transform:none}

    .btn.primary{
      border-color: rgba(120,195,255,.34);
      background:
        radial-gradient(260px 120px at 20% 0%, rgba(255,255,255,.14), transparent 55%),
        linear-gradient(180deg, rgba(120,195,255,.20), rgba(255,255,255,.04));
    }
    .btn.ghost{
      background: rgba(255,255,255,.04);
      border-color: rgba(255,255,255,.12);
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:7px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color:rgba(245,248,255,.78);
      font-size:12px;
      width:fit-content;
    }
    .dot{width:7px;height:7px;border-radius:99px;background:rgba(120,195,255,.85);box-shadow:0 0 0 4px rgba(120,195,255,.14)}

    /* NAV */
    .navwrap{
      position:fixed;
      top:16px; left:0; right:0;
      z-index:60;
      display:flex;
      justify-content:center;
      pointer-events:none;
      transition: transform .35s ease, opacity .35s ease;
    }
    .navwrap.hidden{transform: translateY(-18px); opacity:0}
    .nav{
      pointer-events:auto;
      width:min(var(--max), calc(100% - 28px));
      padding:10px 12px;
      border-radius: 18px;
    }
    .navInner{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding:10px 12px;
      border-radius: 16px;
    }
    .brand{display:flex; align-items:center; gap:12px; min-width: 260px}
    .logo{
      width:40px;height:40px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      overflow:hidden;
      display:grid;
      place-items:center;
      flex:0 0 auto;
    }
    .logo img{width:100%;height:100%;object-fit:cover; transform: translateY(-2px);} /* fixes cut-off */
    .brandText{line-height:1.15; display:flex; flex-direction:column}
    .brandText strong{font-size:13px; letter-spacing:.2px}
    .brandText span{font-size:11px; color:var(--muted2); margin-top:2px}

    .navActions{display:flex; align-items:center; gap:10px}

    /* PAGES */
    .page{display:none}
    .page.show{display:block}

    /* HERO */
    .hero{
      position:relative;
      min-height:100svh;
      padding:112px 0 44px;
      display:flex;
      align-items:center;
      overflow:hidden;
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:-10% -10% -10% -10%;
      background:
        radial-gradient(950px 540px at 50% 22%, rgba(120,195,255,.22), transparent 66%),
        radial-gradient(1200px 800px at 50% 115%, rgba(0,0,0,.55), transparent 70%);
      pointer-events:none;
      z-index:0;
    }
    .heroGrid{
      position:relative;
      z-index:2;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:24px;
      align-items:center;
    }
    h1{
      margin:14px 0 14px;
      font-size: clamp(46px, 6.4vw, 82px);
      letter-spacing: -1.6px;
      line-height:1.02;
    }
    .dim{opacity:.70}
    .lead{
      margin:0 0 18px;
      font-size: clamp(16px, 2.1vw, 20px);
      color:var(--muted);
      line-height:1.45;
      max-width: 560px;
    }
    .heroBtns{display:flex; flex-wrap:wrap; gap:10px; margin-top:14px}
    .scrollHint{margin-top:18px; color:rgba(245,248,255,.60); font-size:12px; display:flex; align-items:center; gap:8px}
    .arrow{
      width:10px;height:10px;
      border-right:2px solid rgba(245,248,255,.55);
      border-bottom:2px solid rgba(245,248,255,.55);
      transform: rotate(45deg);
      margin-top:-2px;
    }

    /* Floating icon bubbles */
    .iconsLayer{position:absolute; inset:0; z-index:1; pointer-events:none;}
    .bubble{
      position:absolute;
      width:150px;height:150px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(circle at 35% 30%, rgba(255,255,255,.07), rgba(255,255,255,.02));
      backdrop-filter: blur(12px) saturate(150%);
      -webkit-backdrop-filter: blur(12px) saturate(150%);
      opacity:.14;
      display:grid;
      place-items:center;
      filter: drop-shadow(0 26px 55px rgba(0,0,0,.45));
      transform: translate(-50%,-50%);
    }
    .bubble svg{
      width:46px;height:46px;
      stroke: rgba(245,248,255,.72);
      fill:none;
      stroke-width: 2.2;
      stroke-linecap: round;
      stroke-linejoin: round;
      opacity:.9;
    }

    /* SECTION */
    .section{padding: 44px 0 34px}
    .titleRow{display:flex; justify-content:space-between; align-items:flex-end; gap:12px; margin-bottom:12px}
    .titleRow h2{margin:0; font-size:14px; color:rgba(245,248,255,.82); letter-spacing:.2px}
    .titleRow .right{font-size:12px; color:rgba(245,248,255,.55); white-space:nowrap}

    .grid4{display:grid; grid-template-columns: repeat(4, 1fr); gap:12px}
    .grid3{display:grid; grid-template-columns: repeat(3, 1fr); gap:12px}

    .card{
      position:relative;
      border-radius: var(--r2);
      border:1px solid rgba(255,255,255,.11);
      background:
        radial-gradient(300px 140px at 25% 0%, rgba(255,255,255,.08), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      padding:14px;
      min-height: 92px;
      transition: transform .15s ease, border-color .2s ease;
      overflow:hidden;
    }
    .card:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.18)}
    .card h4{margin:0; font-size:13px}
    .card .price{margin-top:6px; color:rgba(245,248,255,.74); font-size:12px}
    .card .sub{margin-top:4px; color:rgba(245,248,255,.56); font-size:12px}

    .pick{
      position:absolute;
      right:12px; top:12px;
      width:32px;height:32px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      display:grid;
      place-items:center;
    }
    .pick svg{width:14px;height:14px; stroke: rgba(245,248,255,.70); fill:none; stroke-width:2.6}

    .card.selected{
      border-color: rgba(120,195,255,.34);
      box-shadow: 0 0 0 3px rgba(120,195,255,.10) inset;
      background:
        radial-gradient(360px 160px at 25% 0%, rgba(255,255,255,.10), transparent 60%),
        linear-gradient(180deg, rgba(120,195,255,.16), rgba(255,255,255,.03));
    }
    .card.selected .pick{
      border-color: rgba(120,195,255,.36);
      background: rgba(120,195,255,.16);
    }
    .card.selected .pick svg{stroke: rgba(245,248,255,.92)}

    .learnRow{margin-top:10px; display:flex; justify-content:space-between; align-items:center; gap:10px}
    .learnBtn{
      padding:7px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color:rgba(245,248,255,.82);
      font-size:12px;
      cursor:pointer;
      white-space:nowrap;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }

    .selectedPill{
      font-size:12px;
      color:rgba(245,248,255,.72);
      display:inline-flex;
      align-items:center;
      gap:8px;
      opacity:0;
      transform: translateY(4px);
      transition: opacity .18s ease, transform .18s ease;
    }
    .selectedPill .miniDot{
      width:7px;height:7px;border-radius:99px;background:rgba(120,195,255,.85);
      box-shadow:0 0 0 4px rgba(120,195,255,.14);
    }
    .card.selected .selectedPill{
      opacity:1;
      transform: translateY(0);
    }

    .totalBar{
      position:sticky;
      bottom:14px;
      margin-top:14px;
      display:none;
      z-index:10;
    }
    .totalInner{
      border-radius: 18px;
      padding:12px;
    }
    .totalRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .totalLeft{display:flex; flex-direction:column; gap:2px}
    .totalLeft b{font-size:14px}
    .totalLeft span{font-size:12px; color:rgba(245,248,255,.60)}
    .totalRight{display:flex; gap:10px; align-items:center}

    /* MODALS */
    body.modalOpen{overflow:hidden; touch-action:none;}
    .backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.56);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:120;
      padding:18px;
    }
    .backdrop.show{display:flex}
    .modal{
      width:min(520px, 100%);
      max-height:min(82svh, 760px);
      overflow:hidden;
      border-radius: 20px;
    }
    .modalHead{
      padding:14px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .modalHead b{font-size:13px}
    .modalBody{
      padding:14px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }
    .modalFoot{
      padding:12px 14px 14px;
      border-top:1px solid rgba(255,255,255,.10);
      display:flex;
      gap:10px;
      justify-content:flex-end;
      flex-wrap:wrap;
    }

    .field{margin-bottom:12px}
    .field label{display:block; font-size:12px; color:rgba(245,248,255,.72); margin:0 0 6px}
    .input{
      width:100%;
      padding:11px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color:var(--ink);
      outline:none;
    }
    .input:focus{border-color: rgba(120,195,255,.30); box-shadow: var(--focus)}
    .pwWrap{position:relative}
    .pwToggle{
      position:absolute;
      right:10px;
      top:50%;
      transform: translateY(-50%);
      width:36px;height:36px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      display:grid;
      place-items:center;
      cursor:pointer;
    }
    .pwToggle svg{width:16px;height:16px; stroke:rgba(245,248,255,.76); fill:none; stroke-width:2.2}

    .msg{
      margin-top:8px;
      font-size:12px;
      color:rgba(245,248,255,.64);
      min-height: 16px;
    }
    .msg.bad{color: rgba(255,91,106,.92)}
    .msg.good{color: rgba(53,208,127,.92)}

    /* Dashboard */
    .dashHeader{
      padding: 120px 0 0;
    }
    .dashGrid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
      align-items:start;
    }
    .kvs{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    .kv{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      border-radius: 16px;
      padding:12px;
    }
    .kv span{display:block; font-size:11px; color:rgba(245,248,255,.58)}
    .kv b{display:block; margin-top:4px; font-size:13px; color:rgba(245,248,255,.88)}
    .ownedList{display:grid; gap:10px; margin-top:12px}
    .ownedItem{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      border-radius: 16px;
      padding:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .ownedItem b{font-size:13px}
    .ownedItem span{font-size:12px; color:rgba(245,248,255,.60)}

    /* Responsive */
    @media (max-width: 980px){
      .heroGrid{grid-template-columns:1fr}
      .grid4{grid-template-columns:1fr 1fr}
      .grid3{grid-template-columns:1fr}
      .dashGrid{grid-template-columns:1fr}
    }
    @media (max-width: 520px){
      .container{width:min(var(--max), calc(100% - 28px))}
      .grid4{grid-template-columns:1fr}
      .kvs{grid-template-columns:1fr}
      .bubble{width:124px;height:124px}
      .bubble svg{width:40px;height:40px}
    }
  </style>
</head>

<body>
  <!-- NAV -->
  <div class="navwrap" id="navwrap">
    <div class="nav glass">
      <div class="navInner">
        <div class="brand">
          <div class="logo" aria-hidden="true">
            <img src="SmartCore Official Logos/SC Icon - Black Background.png" alt="SmartCore logo">
          </div>
          <div class="brandText">
            <strong>SmartCore Technology</strong>
            <span>Practical Technology. Built to Last.</span>
          </div>
        </div>

        <div class="navActions" id="navActions">
          <button class="btn ghost" id="navLoginBtn">Log in</button>
        </div>

        <div class="navActions" id="navAuthedActions" style="display:none">
          <button class="btn ghost" id="navHomeBtn">Home</button>
          <button class="btn primary" id="navDashBtn">Dashboard</button>
          <button class="btn ghost" id="navSignOutBtn">Sign out</button>
        </div>
      </div>
    </div>
  </div>

  <!-- HOME PAGE -->
  <div class="page show" id="pageHome">
    <header class="hero" id="hero">
      <div class="iconsLayer" id="iconsLayer" aria-hidden="true"></div>

      <div class="container">
        <div class="heroGrid">
          <div>
            <div class="chip"><span class="dot"></span> Calm systems for real workplaces</div>

            <h1>
              SmartCore <span class="dim">Technology</span>
            </h1>

            <p class="lead">
              Reliable software systems for workspace management â€” practical tools that stay clean, consistent, and easy to run.
            </p>

            <div class="heroBtns">
              <button class="btn primary" id="buildPlanBtn">Build your plan â†’</button>
              <button class="btn" id="employeeSignupBtn">Sign up as an employee</button>
              <button class="btn ghost" id="scrollDownBtn">Scroll down <span class="arrow" aria-hidden="true"></span></button>
            </div>

            <div class="scrollHint">
              <span class="arrow" aria-hidden="true"></span>
              Scroll to build your plan
            </div>
          </div>

          <div class="glass" style="padding:16px; border-radius:20px">
            <div style="font-size:13px; color:rgba(245,248,255,.84); font-weight:700">Platform preview</div>
            <div style="margin-top:6px; font-size:12px; color:rgba(245,248,255,.60); line-height:1.45">
              Minimal, fast, and audit-friendly. Choose a company size, select modules, then checkout to create your account.
            </div>

            <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:12px">
              <div class="kv"><span>Live</span><b>Presence view</b></div>
              <div class="kv"><span>Audit</span><b>Clean records</b></div>
              <div class="kv"><span>Fast</span><b>Kiosk-friendly</b></div>
            </div>

            <div style="margin-top:10px; border:1px dashed rgba(255,255,255,.16); border-radius:16px; padding:10px; color:rgba(245,248,255,.62); font-size:12px">
              During testing, checkout is free â€” it will just create your account and take you to the dashboard.
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- PLAN -->
    <section class="section" id="planSection">
      <div class="container">
        <div class="glass" style="padding:18px" id="planPanel">
          <div class="titleRow">
            <div>
              <h2>Build your plan</h2>
              <div style="margin-top:4px; color:rgba(245,248,255,.55); font-size:12px">Choose a company size, then select modules.</div>
            </div>
            <div class="right">Monthly subscription (GBP)</div>
          </div>

          <div style="margin-top:14px">
            <div class="titleRow" style="margin-bottom:8px">
              <h2>Select your company size</h2>
              <div class="right" id="sizeRight">Select one</div>
            </div>
            <div class="grid4" id="sizeGrid"></div>
          </div>

          <div style="margin-top:16px; display:none" id="modulesWrap">
            <div class="titleRow" style="margin-bottom:8px">
              <h2>Select your modules</h2>
              <div class="right">Select any</div>
            </div>
            <div class="grid3" id="modulesGrid"></div>
          </div>

          <div class="totalBar" id="totalBar">
            <div class="glass totalInner">
              <div class="totalRow">
                <div class="totalLeft">
                  <b id="monthlyTotal">Â£0 / month</b>
                  <span id="monthlyNote">Select a company size to begin</span>
                </div>
                <div class="totalRight">
                  <button class="btn ghost" id="clearBtn">Clear</button>
                  <button class="btn primary" id="checkoutBtn">Checkout â†’</button>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- ABOUT (kept simple here) -->
    <section class="section">
      <div class="container">
        <div class="glass" style="padding:18px">
          <div style="font-size:14px; font-weight:800; color:rgba(245,248,255,.86)">About SmartCore Technology</div>
          <div style="margin-top:10px; color:rgba(245,248,255,.62); font-size:13px; line-height:1.6">
            SmartCore Technology was built by Finley Hassall, a young founder with a long-standing passion for technology and a strong business mindset.
            Interested in IT from the age of six, Finley always knew he wanted to build a career creating systems that solve real-world problems.
            <br><br>
            Rather than focusing on trends or hype, SmartCore Technology was created with a clear goal: to build practical, reliable systems that businesses can depend on every day.
            <br><br>
            The company was developed with guidance and support from Finleyâ€™s mother, a business owner herself, but every system within SmartCore has been hand-crafted from the ground up by Finley.
            Each feature, workflow, and decision has been designed with real workplaces in mind â€” prioritising clarity, usability, and long-term reliability over unnecessary complexity.
            <br><br>
            SmartCore Technology is not about flashy software. Itâ€™s about building tools that work properly, scale sensibly, and quietly do their job in the background.
          </div>

          <div style="margin-top:16px; font-size:14px; font-weight:800; color:rgba(245,248,255,.86)">The SmartCore Technology Approach</div>
          <div style="margin-top:10px; color:rgba(245,248,255,.62); font-size:13px; line-height:1.6">
            SmartCore Technology is built on a simple philosophy: technology should make work easier, not more complicated.
            <ul style="margin:10px 0 0; padding-left:18px">
              <li>solve a specific, real business problem</li>
              <li>be easy to understand and use</li>
              <li>create clear, auditable records</li>
              <li>scale as organisations grow</li>
              <li>remain reliable over time</li>
            </ul>
            <div style="margin-top:12px">
              Instead of offering one large, bloated platform, SmartCore provides modular systems that companies can choose and combine based on their actual needs.
              This keeps costs fair, reduces complexity, and allows businesses to stay in control of how they operate.
            </div>
          </div>
        </div>

        <div style="margin-top:18px; color:rgba(245,248,255,.55); font-size:12px; display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap">
          <div>SmartCore Technology â€” Practical Technology. Built to Last.</div>
          <div>Support: support@smartcoretechnology.co.uk</div>
        </div>
      </div>
    </section>
  </div>

  <!-- DASHBOARD PAGE -->
  <div class="page" id="pageDashboard">
    <div class="dashHeader">
      <div class="container">
        <div class="glass" style="padding:18px">
          <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:12px; flex-wrap:wrap">
            <div>
              <div class="chip"><span class="dot"></span> Account</div>
              <div style="margin-top:10px; font-size:20px; font-weight:900; letter-spacing:-.4px">Dashboard</div>
              <div style="margin-top:6px; color:rgba(245,248,255,.62); font-size:13px">
                Signed in as <span id="dashEmail" style="color:rgba(245,248,255,.86); font-weight:700">â€”</span>
              </div>
            </div>

            <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap">
              <button class="btn ghost" id="dashHomeBtn">Home</button>
              <button class="btn ghost" id="dashSignOutBtn">Sign out</button>
            </div>
          </div>

          <div class="dashGrid" style="margin-top:14px">
            <div>
              <div style="font-size:13px; font-weight:800; color:rgba(245,248,255,.86)">Company</div>

              <div class="kvs">
                <div class="kv">
                  <span>Company name</span>
                  <b id="dashCompanyName">Not set</b>
                </div>
                <div class="kv">
                  <span>Company ID</span>
                  <b id="dashCompanyId">â€”</b>
                </div>
                <div class="kv">
                  <span>Address</span>
                  <b id="dashAddress">Not set</b>
                </div>
                <div class="kv">
                  <span>Status</span>
                  <b id="dashStatus">Ready</b>
                </div>
              </div>

              <div style="margin-top:14px; border-top:1px solid rgba(255,255,255,.10); padding-top:14px">
                <div style="font-size:13px; font-weight:800; color:rgba(245,248,255,.86)">Quick links (owned modules)</div>
                <div class="ownedList" id="dashOwnedLinks" style="margin-top:10px"></div>
                <div style="margin-top:8px; font-size:12px; color:rgba(245,248,255,.55)">
                  (For now, links go to smartcoretechnology.co.uk. Later theyâ€™ll link into each system.)
                </div>
              </div>
            </div>

            <div>
              <div style="font-size:13px; font-weight:800; color:rgba(245,248,255,.86)">Plan</div>
              <div class="ownedList" id="dashPlanList" style="margin-top:10px"></div>

              <div style="margin-top:12px">
                <button class="btn primary" id="dashBuyMoreBtn" style="width:100%">Buy more systems â†’</button>
              </div>

              <div class="msg" id="dashMsg" style="margin-top:10px"></div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <section class="section">
      <div class="container">
        <div class="glass" style="padding:18px">
          <div style="font-size:13px; font-weight:800; color:rgba(245,248,255,.86)">Company onboarding</div>
          <div style="margin-top:8px; color:rgba(245,248,255,.60); font-size:12px; line-height:1.55">
            If your company details arenâ€™t set yet, enter them here. (This UI is ready â€” it will save once your API endpoint is hooked up.)
          </div>

          <div style="margin-top:12px">
            <div class="field">
              <label>Company name</label>
              <input class="input" id="onbCompanyName" placeholder="SmartFits Installations LTD" />
            </div>
            <div class="field">
              <label>Company address</label>
              <input class="input" id="onbCompanyAddress" placeholder="Address" />
            </div>
            <button class="btn primary" id="saveOnboardingBtn">Save company details â†’</button>
            <div class="msg" id="onbMsg"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- LEARN MORE MODAL -->
  <div class="backdrop" id="learnBackdrop" aria-hidden="true">
    <div class="modal glass">
      <div class="modalHead">
        <b id="learnTitle">Module</b>
        <button class="btn ghost" id="learnCloseBtn">Close</button>
      </div>
      <div class="modalBody" id="learnBody"></div>
      <div class="modalFoot">
        <button class="btn ghost" id="learnGotItBtn">Got it</button>
      </div>
    </div>
  </div>

  <!-- SIGNUP / CHECKOUT MODAL -->
  <div class="backdrop" id="signupBackdrop" aria-hidden="true">
    <div class="modal glass">
      <div class="modalHead">
        <b>Create account</b>
        <button class="btn ghost" id="suCloseBtn">Close</button>
      </div>

      <div class="modalBody">
        <div id="signupStep1">
          <div class="field">
            <label>Company name</label>
            <input id="suCompany" class="input" placeholder="SmartCore Technology" autocomplete="organization" />
          </div>

          <div class="field">
            <label>Your full name</label>
            <input id="suFullName" class="input" placeholder="Finley Hassall" autocomplete="name" />
          </div>

          <div class="field">
            <label>Email</label>
            <input id="suEmail" class="input" placeholder="you@company.co.uk" autocomplete="email" />
          </div>

          <div class="field">
            <label>Password</label>
            <div class="pwWrap">
              <input id="suPassword" class="input" type="password" placeholder="Min 8 characters" autocomplete="new-password" />
              <button class="pwToggle" id="suPwToggle" type="button" aria-label="Show password">
                <svg viewBox="0 0 24 24"><path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7-10-7-10-7Z"/><path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/></svg>
              </button>
            </div>
          </div>

          <div class="msg" id="suMsg"></div>
        </div>

        <div id="signupStep2" style="display:none">
          <div class="field">
            <label>6-digit code</label>
            <input id="suCode" class="input" inputmode="numeric" placeholder="123456" />
            <div style="margin-top:6px; font-size:12px; color:rgba(245,248,255,.55)">We sent a code to your email.</div>
          </div>
          <div class="msg" id="suMsg2"></div>
        </div>

        <div style="margin-top:10px">
          <button class="btn ghost" id="loginInsteadBtn" style="width:100%">Log in instead</button>
        </div>
      </div>

      <div class="modalFoot">
        <button class="btn ghost" id="suBackBtn" style="display:none">Back</button>
        <button class="btn primary" id="continueBtn">Continue â†’</button>
        <button class="btn primary" id="verifyBtn" style="display:none">Verify + create â†’</button>
      </div>
    </div>
  </div>

  <!-- LOGIN MODAL -->
  <div class="backdrop" id="loginBackdrop" aria-hidden="true">
    <div class="modal glass">
      <div class="modalHead">
        <b>Log in</b>
        <button class="btn ghost" id="loginCloseBtn">Close</button>
      </div>
      <div class="modalBody">
        <div class="field">
          <label>Email</label>
          <input id="liEmail" class="input" autocomplete="email" />
        </div>
        <div class="field">
          <label>Password</label>
          <div class="pwWrap">
            <input id="liPassword" class="input" type="password" autocomplete="current-password" />
            <button class="pwToggle" id="liPwToggle" type="button" aria-label="Show password">
              <svg viewBox="0 0 24 24"><path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7-10-7-10-7Z"/><path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/></svg>
            </button>
          </div>
        </div>
        <div class="msg" id="liMsg"></div>
      </div>
      <div class="modalFoot">
        <button class="btn primary" id="loginBtn">Log in â†’</button>
      </div>
    </div>
  </div>

  <!-- EMPLOYEE SIGNUP MODAL (placeholder) -->
  <div class="backdrop" id="empBackdrop" aria-hidden="true">
    <div class="modal glass">
      <div class="modalHead">
        <b>Sign up as an employee</b>
        <button class="btn ghost" id="empCloseBtn">Close</button>
      </div>
      <div class="modalBody">
        <div style="color:rgba(245,248,255,.62); font-size:13px; line-height:1.55">
          Employee signup will use your Company ID (e.g. THR624564) and a verification code.
          Weâ€™ll wire this up once owner onboarding is fully stable.
        </div>
        <div class="msg" id="empMsg"></div>
      </div>
      <div class="modalFoot">
        <button class="btn ghost" id="empOkBtn">OK</button>
      </div>
    </div>
  </div>

  <script>
    /* ========= Helpers ========= */
    const $ = (id) => document.getElementById(id);

    function setMsg(el, text, kind){
      el.textContent = text || "";
      el.classList.remove("bad","good");
      if (kind) el.classList.add(kind);
    }

    async function apiPost(path, payload){
      const res = await fetch(path, {
        method:"POST",
        headers: {"content-type":"application/json"},
        body: JSON.stringify(payload || {})
      });
      const text = await res.text();
      let data = null;
      try { data = JSON.parse(text); } catch { data = { raw: text }; }
      if (!res.ok){
        const msg = (data && (data.error || data.message)) ? (data.error || data.message) : text;
        throw new Error(msg || ("Request failed: " + res.status));
      }
      return data;
    }

    function openModal(id){
      $(id).classList.add("show");
      $(id).setAttribute("aria-hidden","false");
      document.body.classList.add("modalOpen");
    }
    function closeModal(id){
      $(id).classList.remove("show");
      $(id).setAttribute("aria-hidden","true");
      document.body.classList.remove("modalOpen");
    }

    function scrollToPlan(){
      $("planSection").scrollIntoView({behavior:"smooth", block:"start"});
    }

    /* ========= Session storage ========= */
    const LS_KEY = "smartcore_session_v1";

    function saveSession(session){
      localStorage.setItem(LS_KEY, JSON.stringify(session));
    }
    function loadSession(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        return raw ? JSON.parse(raw) : null;
      }catch{return null}
    }
    function clearSession(){
      localStorage.removeItem(LS_KEY);
    }

    /* ========= Routing (Home / Dashboard) ========= */
    function showPage(which){
      $("pageHome").classList.toggle("show", which === "home");
      $("pageDashboard").classList.toggle("show", which === "dashboard");
    }

    function goHome(){
      window.location.hash = "#home";
      showPage("home");
      // show unauth nav if not signed in
      syncNavAuth();
    }

    async function goDashboard(){
      window.location.hash = "#dashboard";
      showPage("dashboard");
      syncNavAuth();
      await loadDashboard();
    }

    function syncNavAuth(){
      const sess = loadSession();
      const authed = !!(sess && sess.user && sess.user.email);
      $("navActions").style.display = authed ? "none" : "flex";
      $("navAuthedActions").style.display = authed ? "flex" : "none";
      if (authed){
        $("dashEmail").textContent = sess.user.email || "â€”";
      }
    }

    window.addEventListener("hashchange", () => {
      const h = (window.location.hash || "#home").toLowerCase();
      if (h === "#dashboard") goDashboard();
      else goHome();
    });

    /* ========= Plan data ========= */
    const COMPANY_SIZES = [
      { id:"up_to_25", label:"Up to 25 people", price:39, note:"Â£39 / month" },
      { id:"26_100", label:"26â€“100 people", price:79, note:"Â£79 / month" },
      { id:"101_250", label:"101â€“250 people", price:149, note:"Â£149 / month" },
      { id:"250_plus", label:"250+ people", price:null, note:"Contact us" }
    ];

    const MODULES = [
      { id:"presence_fire", name:"Presence & Fire Safety", price:10,
        summary:"A real-time presence system that shows exactly who is on site at any moment. Staff and visitors sign in and out digitally, creating a live evacuation list that can be used immediately during fire drills or real emergencies.",
        extra:"Designed to be simple, fast, and reliable when it matters most, with clear records for audits and incident reviews.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3"
      },
      { id:"policies_handbook", name:"Policies & Staff Handbook", price:7,
        summary:"A central location for company policies and staff handbooks, with tracking to show who has read and acknowledged each document.",
        extra:"Managers can update policies, request re-acknowledgement, and view clear records at any time. Helps organisations demonstrate that information has been issued and acknowledged without relying on paper or email chains.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3"
      },
      { id:"holiday_booking", name:"Holiday Booking", price:8,
        summary:"A straightforward holiday request and approval system that removes unnecessary back-and-forth.",
        extra:"Staff submit requests, managers approve or decline, and teams can view upcoming absences in one place. Intentionally simple and focused, with no payroll or salary management.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3"
      },
      { id:"accident_book", name:"Accident & Injury Book", price:3,
        summary:"A digital accident and injury reporting system that replaces paper accident books.",
        extra:"Incidents can be logged quickly with notes, photos, and witness details, and records can be exported when required. Keeps incident records organised, secure, and easy to access if they are ever needed.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3"
      },
      { id:"training_compliance", name:"Training & Compliance", price:9,
        summary:"Tracks training expiry dates, compliance requirements, and scheduled checks across the organisation.",
        extra:"Automatic reminders help ensure nothing is missed, from fire drills to equipment inspections and vehicle compliance. Designed to support consistency and oversight without adding unnecessary complexity.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3"
      },
      { id:"onboarding_offboarding", name:"Onboarding & Offboarding", price:8,
        summary:"Structured checklists for new starters and leavers, helping teams complete tasks consistently across departments.",
        extra:"From access setup to equipment returns, nothing is forgotten. Provides a clear record of what was completed and when, supporting smoother staff transitions.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3"
      },
      { id:"expenses_upload", name:"Expenses Upload", price:6,
        summary:"Allows staff to upload receipts digitally with notes and categories, removing the need to collect paper receipts.",
        extra:"Submissions can be reviewed and exported for accounting or payroll systems. Keeps expense handling simple, organised, and traceable.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3"
      },
      { id:"wellbeing_check", name:"Wellbeing Check", price:4,
        summary:"A lightweight wellbeing check-in with three options: ðŸ™‚ Positive (green), ðŸ˜ Neutral (amber), ðŸ™ Concerned (red).",
        extra:"Over time, this provides managers with a simple, high-level view of wellbeing trends across teams. No medical data, no intrusive questions â€” just a clear, visual pulse check designed to support awareness while respecting privacy.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3"
      }
    ];

    let selectedSizeId = null;
    let selectedModuleIds = new Set();
    let pendingSignup = null;

    function renderSizes(){
      const grid = $("sizeGrid");
      grid.innerHTML = "";
      COMPANY_SIZES.forEach(sz => {
        const el = document.createElement("div");
        el.className = "card";
        el.dataset.sizeId = sz.id;
        el.innerHTML = `
          <div class="pick"><svg viewBox="0 0 24 24"><path d="M20 6 9 17l-5-5"/></svg></div>
          <h4>${sz.label}</h4>
          <div class="price">${sz.note}</div>
          <div class="sub">${sz.id==="250_plus" ? "Weâ€™ll quote based on requirements." : "Checkout online in minutes."}</div>
        `;
        el.addEventListener("click", () => {
          selectedSizeId = sz.id;
          selectedModuleIds = new Set();
          $("modulesWrap").style.display = "block";
          $("totalBar").style.display = "block";
          $("sizeRight").textContent = sz.label;
          updateSelectionUI();
        });
        grid.appendChild(el);
      });
    }

    function renderModules(){
      const grid = $("modulesGrid");
      grid.innerHTML = "";
      MODULES.forEach(m => {
        const el = document.createElement("div");
        el.className = "card";
        el.dataset.moduleId = m.id;
        el.innerHTML = `
          <div class="pick"><svg viewBox="0 0 24 24"><path d="M20 6 9 17l-5-5"/></svg></div>
          <h4>${m.name}</h4>
          <div class="price">Â£${m.price} / month</div>

          <div class="learnRow">
            <button class="learnBtn" type="button" data-learn="${m.id}">Learn more</button>
            <div class="selectedPill"><span class="miniDot"></span> Selected</div>
          </div>
        `;

        el.addEventListener("click", (e) => {
          if (e.target.closest("[data-learn]")) return;
          if (!selectedSizeId) return;
          if (selectedModuleIds.has(m.id)) selectedModuleIds.delete(m.id);
          else selectedModuleIds.add(m.id);
          updateSelectionUI();
        });

        el.querySelector("[data-learn]").addEventListener("click", (e) => {
          e.preventDefault();
          e.stopPropagation();
          openLearnMore(m.id);
        });

        grid.appendChild(el);
      });
    }

    function updateSelectionUI(){
      document.querySelectorAll("[data-size-id]").forEach(el => {
        el.classList.toggle("selected", el.dataset.sizeId === selectedSizeId);
      });
      document.querySelectorAll("[data-module-id]").forEach(el => {
        el.classList.toggle("selected", selectedModuleIds.has(el.dataset.moduleId));
      });

      const size = COMPANY_SIZES.find(s => s.id === selectedSizeId);
      let base = size ? (size.price || 0) : 0;
      let mods = 0;
      selectedModuleIds.forEach(id => {
        const m = MODULES.find(x => x.id === id);
        if (m) mods += m.price;
      });

      if (!selectedSizeId){
        $("monthlyTotal").textContent = "Â£0 / month";
        $("monthlyNote").textContent = "Select a company size to begin";
        $("checkoutBtn").disabled = true;
        return;
      }

      $("checkoutBtn").disabled = false;
      if (selectedSizeId === "250_plus"){
        $("monthlyTotal").textContent = "Custom / month";
        $("monthlyNote").textContent = "250+ people â€” contact us to quote";
      }else{
        $("monthlyTotal").textContent = `Â£${base + mods} / month`;
        $("monthlyNote").textContent = `${size.label} â€¢ ${selectedModuleIds.size} module${selectedModuleIds.size===1?"":"s"}`;
      }
    }

    function clearAll(){
      selectedSizeId = null;
      selectedModuleIds = new Set();
      $("modulesWrap").style.display = "none";
      $("totalBar").style.display = "none";
      $("sizeRight").textContent = "Select one";
      updateSelectionUI();
    }

    /* ========= Learn more ========= */
    function makeYoutubeEmbed(url){
      try{
        const u = new URL(url);
        let id = "";
        if (u.hostname.includes("youtu.be")) id = u.pathname.replace("/","");
        if (u.hostname.includes("youtube.com") && u.searchParams.get("v")) id = u.searchParams.get("v");
        const embed = `https://www.youtube.com/embed/${encodeURIComponent(id)}?rel=0&modestbranding=1`;
        return `
          <iframe
            src="${embed}"
            title="Module preview"
            style="width:100%; aspect-ratio:16/9; border:0; display:block"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen"
            allowfullscreen
          ></iframe>
        `;
      }catch{
        return `<div style="padding:14px; color:rgba(245,248,255,.62); font-size:13px">Preview unavailable</div>`;
      }
    }

    function escapeHtml(s){
      return String(s||"").replace(/[&<>"']/g, (c)=>({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[c]));
    }

    function openLearnMore(id){
      const m = MODULES.find(x => x.id === id);
      if (!m) return;
      $("learnTitle").textContent = m.name;
      $("learnBody").innerHTML = `
        <div style="display:grid; gap:12px">
          <div style="border:1px solid rgba(255,255,255,.10); border-radius:18px; overflow:hidden; background:rgba(0,0,0,.18)">
            ${makeYoutubeEmbed(m.video)}
          </div>
          <div style="color:rgba(245,248,255,.72); font-size:13px">
            <b style="color:rgba(245,248,255,.90)">Â£${m.price} / month</b>
          </div>
          <div style="color:rgba(245,248,255,.62); font-size:13px; line-height:1.55">${escapeHtml(m.summary)}</div>
          <div style="color:rgba(245,248,255,.62); font-size:13px; line-height:1.55">${escapeHtml(m.extra)}</div>
        </div>
      `;
      openModal("learnBackdrop");
    }

    /* ========= Signup flow (code first, then create) ========= */
    function openSignup(){
      if (!selectedSizeId){ scrollToPlan(); return; }
      $("signupStep1").style.display = "block";
      $("signupStep2").style.display = "none";
      $("continueBtn").style.display = "inline-flex";
      $("verifyBtn").style.display = "none";
      $("suBackBtn").style.display = "none";
      setMsg($("suMsg"), "", null);
      setMsg($("suMsg2"), "", null);
      openModal("signupBackdrop");
    }

    function closeSignup(){
      closeModal("signupBackdrop");
      pendingSignup = null;
      $("suCode").value = "";
    }

    async function sendCodeForOwner(){
      const company_name = $("suCompany").value.trim();
      const full_name = $("suFullName").value.trim();
      const email = $("suEmail").value.trim().toLowerCase();
      const password = $("suPassword").value;

      if (!company_name || !full_name || !email || !password){
        setMsg($("suMsg"), "Please fill in company name, your full name, email and password.", "bad");
        return;
      }
      if (password.length < 8){
        setMsg($("suMsg"), "Password must be at least 8 characters.", "bad");
        return;
      }

      pendingSignup = {
        company_name, full_name, email, password,
        company_size: selectedSizeId,
        module_ids: Array.from(selectedModuleIds)
      };

      $("continueBtn").disabled = true;

      try{
        await apiPost("/api/send-code", { email, purpose:"owner_signup" });

        $("signupStep1").style.display = "none";
        $("signupStep2").style.display = "block";
        $("continueBtn").style.display = "none";
        $("verifyBtn").style.display = "inline-flex";
        $("suBackBtn").style.display = "inline-flex";

        setMsg($("suMsg2"), "Code sent. Enter it below to create your account.", "good");
      }catch(e){
        setMsg($("suMsg"), e.message || "Failed to send code.", "bad");
      }finally{
        $("continueBtn").disabled = false;
      }
    }

    function signupBack(){
      $("signupStep1").style.display = "block";
      $("signupStep2").style.display = "none";
      $("continueBtn").style.display = "inline-flex";
      $("verifyBtn").style.display = "none";
      $("suBackBtn").style.display = "none";
      $("suCode").value = "";
      setMsg($("suMsg"), "", null);
      setMsg($("suMsg2"), "", null);
    }

    async function verifyAndCreateOwner(){
      if (!pendingSignup){
        setMsg($("suMsg2"), "Press Continue first.", "bad");
        return;
      }
      const code = $("suCode").value.trim();
      if (!code || code.length !== 6){
        setMsg($("suMsg2"), "Enter the 6-digit code.", "bad");
        return;
      }

      $("verifyBtn").disabled = true;

      try{
        const data = await apiPost("/api/verify-code", {
          purpose: "owner_signup",
          email: pendingSignup.email,
          code,
          full_name: pendingSignup.full_name,
          password: pendingSignup.password,
          company_name: pendingSignup.company_name,
          company_size: pendingSignup.company_size,
          module_ids: pendingSignup.module_ids
        });

        // Expect verify-code to return something like:
        // { ok:true, session:{access_token,refresh_token}, user:{id,email}, company:{...}, owned_module_ids:[...] }
        if (!data || data.ok !== true){
          throw new Error("Create user failed (no ok:true).");
        }
        if (!data.user || !data.user.email){
          throw new Error("Create user failed (no user).");
        }

        // Save session (even if only user is returned)
        saveSession({
          user: data.user,
          session: data.session || null,
          company: data.company || null,
          owned_module_ids: data.owned_module_ids || pendingSignup.module_ids || []
        });

        closeSignup();
        await goDashboard();
      }catch(e){
        setMsg($("suMsg2"), e.message || "Create failed.", "bad");
      }finally{
        $("verifyBtn").disabled = false;
      }
    }

    /* ========= Login (wired) ========= */
    function openLogin(){
      setMsg($("liMsg"), "", null);
      $("liEmail").value = "";
      $("liPassword").value = "";
      openModal("loginBackdrop");
    }

    async function doLogin(){
      setMsg($("liMsg"), "", null);
      const email = $("liEmail").value.trim().toLowerCase();
      const password = $("liPassword").value;
      if (!email || !password){
        setMsg($("liMsg"), "Enter email and password.", "bad");
        return;
      }

      $("loginBtn").disabled = true;

      try{
        // Your Cloudflare Function should exist as /functions/api/login.js -> /api/login
        // Expected response example:
        // { ok:true, user:{id,email}, company:{...}, owned_module_ids:[...], session:{access_token,refresh_token} }
        const data = await apiPost("/api/login", { email, password });

        if (!data || data.ok !== true) throw new Error("Login failed.");
        if (!data.user || !data.user.email) throw new Error("Login failed (no user).");

        saveSession({
          user: data.user,
          session: data.session || null,
          company: data.company || null,
          owned_module_ids: data.owned_module_ids || []
        });

        closeModal("loginBackdrop");
        await goDashboard();
      }catch(e){
        setMsg($("liMsg"), e.message || "Login failed.", "bad");
      }finally{
        $("loginBtn").disabled = false;
      }
    }

    /* ========= Dashboard rendering ========= */
    function moduleNameById(id){
      const m = MODULES.find(x => x.id === id);
      return m ? m.name : id;
    }

    async function loadDashboard(){
      const sess = loadSession();
      if (!sess || !sess.user){
        // Not signed in -> send home
        goHome();
        return;
      }

      $("dashEmail").textContent = sess.user.email || "â€”";

      // If your /api/login or /api/verify-code returns company, show it:
      const company = sess.company || null;
      $("dashCompanyName").textContent = company?.company_name || "Not set";
      $("dashCompanyId").textContent = company?.company_id || company?.company_code || "â€”";
      $("dashAddress").textContent = company?.address || "Not set";

      const owned = Array.isArray(sess.owned_module_ids) ? sess.owned_module_ids : [];
      const planList = $("dashPlanList");
      const linksList = $("dashOwnedLinks");
      planList.innerHTML = "";
      linksList.innerHTML = "";

      if (!owned.length){
        planList.innerHTML = `<div class="ownedItem"><span>No modules yet</span><b>Choose some below</b></div>`;
        linksList.innerHTML = `<div class="ownedItem"><span>â€”</span><b>No quick links yet</b></div>`;
      }else{
        owned.forEach(mid => {
          const name = moduleNameById(mid);
          const row = document.createElement("div");
          row.className = "ownedItem";
          row.innerHTML = `<div><b>${name}</b><div><span>Included in your plan</span></div></div><div><span>Â£ / month</span></div>`;
          planList.appendChild(row);

          const link = document.createElement("div");
          link.className = "ownedItem";
          link.innerHTML = `<div><b>${name}</b><div><span>Open system</span></div></div><a class="btn ghost" href="https://smartcoretechnology.co.uk" target="_blank" rel="noopener">Open â†’</a>`;
          linksList.appendChild(link);
        });
      }

      setMsg($("dashMsg"), "", null);
    }

    function signOut(){
      clearSession();
      syncNavAuth();
      goHome();
    }

    /* ========= Nav auto-hide ========= */
    function setupNavAutoHide(){
      const navwrap = $("navwrap");
      const hero = $("hero");

      const onScroll = () => {
        const y = window.scrollY || document.documentElement.scrollTop;
        const heroH = hero ? hero.getBoundingClientRect().height : 600;
        const threshold = Math.max(260, heroH * 0.78);
        if (y > threshold) navwrap.classList.add("hidden");
        else navwrap.classList.remove("hidden");
      };

      window.addEventListener("scroll", onScroll, {passive:true});
      onScroll();
    }

    /* ========= Floating icons ========= */
    function iconSvg(type){
      const svgs = {
        plus:`<svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>`,
        check:`<svg viewBox="0 0 24 24"><path d="M20 6 9 17l-5-5"/></svg>`,
        lock:`<svg viewBox="0 0 24 24"><path d="M7 11V8a5 5 0 0 1 10 0v3"/><path d="M6 11h12v10H6z"/></svg>`,
        list:`<svg viewBox="0 0 24 24"><path d="M8 6h13M8 12h13M8 18h13"/><path d="M3 6h.01M3 12h.01M3 18h.01"/></svg>`,
        target:`<svg viewBox="0 0 24 24"><path d="M12 2v4M12 18v4M2 12h4M18 12h4"/><path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"/></svg>`,
        badge:`<svg viewBox="0 0 24 24"><path d="M12 2 19 6v6c0 5-3.5 8.5-7 10-3.5-1.5-7-5-7-10V6z"/></svg>`,
        brief:`<svg viewBox="0 0 24 24"><path d="M9 6V4h6v2"/><path d="M4 7h16v13H4z"/><path d="M4 12h16"/></svg>`,
        hex:`<svg viewBox="0 0 24 24"><path d="M7 3h10l4 7-4 11H7L3 10z"/><path d="M12 8v8"/></svg>`
      };
      return svgs[type] || svgs.plus;
    }

    function buildIcons(){
      const layer = $("iconsLayer");
      if (!layer) return;
      layer.innerHTML = "";

      const placements = [
        {x: 12, y: 22, s: 150, t:"plus"},
        {x: 84, y: 20, s: 140, t:"lock"},
        {x: 14, y: 64, s: 140, t:"check"},
        {x: 86, y: 64, s: 150, t:"brief"},
        {x: 72, y: 40, s: 150, t:"hex"},
        {x: 44, y: 76, s: 160, t:"list"},
        {x: 60, y: 22, s: 135, t:"target"},
        {x: 26, y: 36, s: 135, t:"badge"},
      ];

      placements.forEach(p => {
        const d = document.createElement("div");
        d.className = "bubble";
        d.style.left = p.x + "%";
        d.style.top = p.y + "%";
        d.style.width = p.s + "px";
        d.style.height = p.s + "px";
        d.innerHTML = iconSvg(p.t);
        layer.appendChild(d);
      });

      const applySmall = () => {
        const w = window.innerWidth;
        const all = layer.querySelectorAll(".bubble");
        if (w < 560){
          all.forEach(b => { b.style.width="118px"; b.style.height="118px"; b.style.opacity=".12"; });
        }else{
          all.forEach(b => { b.style.opacity=".14"; });
        }
      };
      window.addEventListener("resize", applySmall);
      applySmall();
    }

    /* ========= Password toggles ========= */
    function setupPwToggle(inputId, btnId){
      const inp = $(inputId);
      const btn = $(btnId);
      btn.addEventListener("click", () => {
        const isPw = inp.type === "password";
        inp.type = isPw ? "text" : "password";
        btn.setAttribute("aria-label", isPw ? "Hide password" : "Show password");
      });
    }

    /* ========= Wire UI ========= */
    function wireUI(){
      $("scrollDownBtn").addEventListener("click", scrollToPlan);
      $("buildPlanBtn").addEventListener("click", scrollToPlan);

      $("clearBtn").addEventListener("click", clearAll);
      $("checkoutBtn").addEventListener("click", openSignup);

      $("navLoginBtn").addEventListener("click", openLogin);

      $("navHomeBtn").addEventListener("click", goHome);
      $("navDashBtn").addEventListener("click", goDashboard);
      $("navSignOutBtn").addEventListener("click", signOut);

      $("dashHomeBtn").addEventListener("click", goHome);
      $("dashSignOutBtn").addEventListener("click", signOut);

      $("dashBuyMoreBtn").addEventListener("click", () => {
        // go home and jump to plan
        goHome();
        setTimeout(scrollToPlan, 50);
      });

      // Learn modal
      $("learnCloseBtn").addEventListener("click", () => closeModal("learnBackdrop"));
      $("learnGotItBtn").addEventListener("click", () => closeModal("learnBackdrop"));
      $("learnBackdrop").addEventListener("click", (e) => { if (e.target === $("learnBackdrop")) closeModal("learnBackdrop"); });

      // Signup modal
      $("suCloseBtn").addEventListener("click", closeSignup);
      $("signupBackdrop").addEventListener("click", (e) => { if (e.target === $("signupBackdrop")) closeSignup(); });
      $("continueBtn").addEventListener("click", sendCodeForOwner);
      $("verifyBtn").addEventListener("click", verifyAndCreateOwner);
      $("suBackBtn").addEventListener("click", signupBack);
      $("loginInsteadBtn").addEventListener("click", () => { closeSignup(); openLogin(); });

      // Login modal
      $("loginCloseBtn").addEventListener("click", () => closeModal("loginBackdrop"));
      $("loginBackdrop").addEventListener("click", (e) => { if (e.target === $("loginBackdrop")) closeModal("loginBackdrop"); });
      $("loginBtn").addEventListener("click", doLogin);

      // Employee modal
      $("employeeSignupBtn").addEventListener("click", () => openModal("empBackdrop"));
      $("empCloseBtn").addEventListener("click", () => closeModal("empBackdrop"));
      $("empOkBtn").addEventListener("click", () => closeModal("empBackdrop"));
      $("empBackdrop").addEventListener("click", (e) => { if (e.target === $("empBackdrop")) closeModal("empBackdrop"); });

      // Password toggles
      setupPwToggle("suPassword","suPwToggle");
      setupPwToggle("liPassword","liPwToggle");

      // Company onboarding save (placeholder)
      $("saveOnboardingBtn").addEventListener("click", async () => {
        setMsg($("onbMsg"), "", null);
        const sess = loadSession();
        if (!sess || !sess.user) { setMsg($("onbMsg"), "You must be logged in.", "bad"); return; }

        const company_name = $("onbCompanyName").value.trim();
        const address = $("onbCompanyAddress").value.trim();
        if (!company_name) { setMsg($("onbMsg"), "Enter a company name.", "bad"); return; }

        // If you have /api/save-company-details, wire it here.
        // For now we update locally so dashboard shows it.
        sess.company = sess.company || {};
        sess.company.company_name = company_name;
        sess.company.address = address;
        saveSession(sess);

        setMsg($("onbMsg"), "Saved (local for now). Wire to API when ready.", "good");
        await loadDashboard();
      });
    }

    /* ========= Init ========= */
    function init(){
      renderSizes();
      renderModules();
      updateSelectionUI();

      $("modulesWrap").style.display = "none";
      $("totalBar").style.display = "none";

      setupNavAutoHide();
      buildIcons();
      wireUI();

      // If already signed in and hash is dashboard, load it.
      syncNavAuth();
      const h = (window.location.hash || "#home").toLowerCase();
      if (h === "#dashboard") goDashboard();
      else goHome();
    }

    init();
  </script>
</body>
</html>
