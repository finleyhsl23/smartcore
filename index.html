<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SmartCore Technology</title>
  <meta name="theme-color" content="#050814" />

  <style>
    :root{
      --bg0:#050814;
      --bg1:#08102a;
      --bg2:#0a1b44;
      --ink:#e7ecff;
      --muted:rgba(231,236,255,.72);
      --muted2:rgba(231,236,255,.55);
      --line:rgba(255,255,255,.10);
      --glass:rgba(12,18,40,.58);
      --glass2:rgba(12,18,40,.36);
      --shadow: 0 22px 70px rgba(0,0,0,.55);
      --shadow2: 0 14px 40px rgba(0,0,0,.45);
      --radius:18px;
      --radius2:14px;
      --accent:#5aa0ff;
      --good:#35d07f;
      --warn:#ffbf3b;
      --bad:#ff5b6a;
      --btn:#0f1b3a;
      --btn2:#0b1330;
      --focus: 0 0 0 3px rgba(90,160,255,.22);
      --max: 1120px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink);
      background:
        radial-gradient(1200px 780px at 50% 20%, rgba(90,160,255,.24), transparent 62%),
        radial-gradient(980px 680px at 18% 78%, rgba(90,160,255,.14), transparent 60%),
        radial-gradient(980px 680px at 86% 76%, rgba(90,160,255,.10), transparent 62%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 30%, var(--bg0) 100%);
      overflow-x:hidden;
    }

    a{color:inherit; text-decoration:none}
    button{font:inherit}
    input,select,textarea{font:inherit}

    /* ---------- Layout ---------- */
    .container{width:min(var(--max), calc(100% - 40px)); margin:0 auto}
    .hero{
      position:relative;
      min-height:100svh;
      display:flex;
      align-items:center;
      padding:110px 0 40px;
      overflow:hidden;
    }

    /* Center glow */
    .hero::before{
      content:"";
      position:absolute;
      inset:-10% -10% -10% -10%;
      background:
        radial-gradient(900px 520px at 50% 25%, rgba(90,160,255,.22), transparent 64%),
        radial-gradient(1200px 900px at 50% 110%, rgba(0,0,0,.55), transparent 70%);
      pointer-events:none;
      z-index:0;
    }

    .navwrap{
      position:fixed;
      top:16px;
      left:0;
      right:0;
      z-index:50;
      display:flex;
      justify-content:center;
      pointer-events:none;
      transition: transform .35s ease, opacity .35s ease;
    }
    .navwrap.hidden{
      transform: translateY(-18px);
      opacity:0;
    }
    .nav{
      pointer-events:auto;
      width:min(var(--max), calc(100% - 28px));
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:16px;
      background:linear-gradient(180deg, rgba(16,22,46,.58), rgba(10,14,34,.38));
      backdrop-filter: blur(18px);
      box-shadow: var(--shadow2);
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:260px;
    }
    .brand .logo{
      width:36px; height:36px;
      border-radius:11px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      display:grid;
      place-items:center;
      overflow:hidden;
      flex:0 0 auto;
    }
    .brand .logo img{
      width:100%;
      height:100%;
      object-fit:cover;
      transform: translateY(-2px); /* fixes clipped glyphs */
    }
    .brand .name{
      line-height:1.15;
      display:flex;
      flex-direction:column;
    }
    .brand .name strong{
      font-size:13px;
      letter-spacing:.2px;
    }
    .brand .name span{
      font-size:11px;
      color:var(--muted2);
      margin-top:2px;
    }

    .nav .actions{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(15,27,58,.70), rgba(11,19,48,.55));
      color:var(--ink);
      cursor:pointer;
      transition: transform .12s ease, background .2s ease, border-color .2s ease, opacity .2s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.18)}
    .btn:active{transform: translateY(0)}
    .btn.primary{
      background: linear-gradient(180deg, rgba(90,160,255,.22), rgba(15,27,58,.60));
      border-color: rgba(90,160,255,.32);
    }
    .btn.ghost{
      background: rgba(255,255,255,.04);
      border-color: rgba(255,255,255,.10);
    }
    .btn:focus{outline:none; box-shadow: var(--focus)}
    .btn[disabled]{opacity:.55; cursor:not-allowed; transform:none}

    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color:rgba(231,236,255,.78);
      font-size:12px;
      width:fit-content;
    }
    .dot{width:6px;height:6px;border-radius:99px;background:rgba(90,160,255,.75);box-shadow:0 0 0 3px rgba(90,160,255,.12)}

    /* ---------- Hero content ---------- */
    .heroGrid{
      position:relative;
      z-index:2;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:26px;
      align-items:center;
    }
    .heroCopy{
      max-width: 640px;
    }
    h1{
      margin:14px 0 14px;
      font-size: clamp(44px, 6vw, 78px);
      letter-spacing: -1.4px;
      line-height:1.02;
    }
    h1 .dim{
      opacity:.72; /* ‚ÄúTechnology‚Äù lower opacity */
      display:inline-block;
    }
    .lead{
      margin:0 0 20px;
      font-size: clamp(16px, 2vw, 20px);
      color: var(--muted);
      line-height:1.45;
      max-width: 560px;
    }
    .heroBtns{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:16px;
    }
    .scrollHint{
      margin-top:18px;
      color:rgba(231,236,255,.60);
      font-size:12px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .arrow{
      width:10px;height:10px; border-right:2px solid rgba(231,236,255,.55); border-bottom:2px solid rgba(231,236,255,.55);
      transform: rotate(45deg);
      margin-top:-2px;
    }

    /* Right hero card preview */
    .heroCard{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(16,22,46,.56), rgba(10,14,34,.34));
      backdrop-filter: blur(18px);
      box-shadow: var(--shadow);
      padding:16px;
      position:relative;
      overflow:hidden;
    }
    .heroCard h3{margin:0; font-size:13px; color:rgba(231,236,255,.82); letter-spacing:.2px}
    .heroCard p{margin:6px 0 0; color:rgba(231,236,255,.58); font-size:12px; line-height:1.45}
    .miniStats{
      margin-top:12px;
      display:grid;
      grid-template-columns: repeat(3,1fr);
      gap:10px;
    }
    .mini{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      border-radius: 12px;
      padding:10px;
    }
    .mini b{display:block; font-size:16px; letter-spacing:.2px}
    .mini span{font-size:11px; color:rgba(231,236,255,.56)}
    .heroCard .note{
      margin-top:10px;
      border:1px dashed rgba(255,255,255,.14);
      border-radius: 12px;
      padding:10px;
      color:rgba(231,236,255,.62);
      font-size:12px;
    }

    /* ---------- Floating icons (scattered, non-overlapping w/ text) ---------- */
    .iconsLayer{
      position:absolute;
      inset:0;
      z-index:1; /* behind content, but above background */
      pointer-events:none;
    }
    .iconBubble{
      position:absolute;
      width:150px;
      height:150px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.09);
      background: radial-gradient(circle at 35% 30%, rgba(255,255,255,.05), rgba(255,255,255,.02));
      backdrop-filter: blur(10px);
      display:grid;
      place-items:center;
      opacity:.18; /* lower opacity */
      filter: drop-shadow(0 20px 40px rgba(0,0,0,.35));
      transform: translateZ(0);
      transition: opacity .25s ease;
    }
    .iconBubble svg{
      width:44px; height:44px;
      opacity:.85;
      stroke: rgba(231,236,255,.70);
      fill: none;
      stroke-width: 2.1;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    /* Keep icons OUT of the text block area (approx). */
    .iconBubble.safeZone{
      opacity:.14;
    }

    /* ---------- Sections ---------- */
    section{position:relative; z-index:2}
    .section{
      padding: 44px 0 34px;
    }

    .glassPanel{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(16,22,46,.54), rgba(10,14,34,.32));
      backdrop-filter: blur(18px);
      box-shadow: var(--shadow2);
      padding: 18px;
    }

    .twoCol{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
      align-items:start;
    }

    .sectionTitle{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      margin-bottom: 10px;
    }
    .sectionTitle h2{
      margin:0;
      font-size:14px;
      color:rgba(231,236,255,.78);
      letter-spacing:.3px;
      text-transform:none;
    }
    .sectionTitle .right{
      font-size:12px;
      color:rgba(231,236,255,.55);
      white-space:nowrap;
    }

    .grid4{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:12px;
    }
    .grid3{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }

    .card{
      position:relative;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      border-radius: 14px;
      padding:14px;
      min-height: 92px;
      overflow:hidden;
      transition: border-color .2s ease, transform .15s ease, background .2s ease;
    }
    .card:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.16)}
    .card h4{margin:0; font-size:13px}
    .card .sub{margin-top:4px; color:rgba(231,236,255,.58); font-size:12px}
    .card .price{margin-top:6px; color:rgba(231,236,255,.72); font-size:12px}

    .pickBtn{
      position:absolute;
      right:12px; top:12px;
      width:30px; height:30px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.15);
      display:grid;
      place-items:center;
      cursor:pointer;
    }
    .pickBtn svg{width:14px;height:14px;stroke:rgba(231,236,255,.65);fill:none;stroke-width:2.4}

    .card.selected{
      border-color: rgba(90,160,255,.36);
      background: linear-gradient(180deg, rgba(90,160,255,.12), rgba(255,255,255,.04));
      box-shadow: 0 0 0 3px rgba(90,160,255,.10) inset;
    }
    .card.selected .pickBtn{
      border-color: rgba(90,160,255,.40);
      background: rgba(90,160,255,.16);
    }
    .card.selected .pickBtn svg{stroke: rgba(231,236,255,.92)}

    .learnRow{
      margin-top:10px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .learnBtn{
      padding:7px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color:rgba(231,236,255,.78);
      font-size:12px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap; /* one line */
    }
    .learnBtn:hover{border-color: rgba(255,255,255,.18)}
    .tick{
      display:inline-flex;
      align-items:center;
      gap:8px;
      color:rgba(231,236,255,.55);
      font-size:12px;
    }
    .tick strong{color:rgba(231,236,255,.82); font-weight:600}

    /* Sticky total bar (hidden until company size selected) */
    .totalBar{
      position:sticky;
      bottom:14px;
      z-index:5;
      margin-top:14px;
      display:none;
    }
    .totalBarInner{
      border:1px solid var(--line);
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(16,22,46,.58), rgba(10,14,34,.38));
      backdrop-filter: blur(18px);
      box-shadow: var(--shadow2);
      padding:12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .totalLeft{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .totalLeft b{font-size:14px}
    .totalLeft span{font-size:12px; color:rgba(231,236,255,.60)}
    .totalRight{display:flex; gap:10px; align-items:center}

    /* About */
    .about h3{margin:0 0 10px; font-size:14px; color:rgba(231,236,255,.84)}
    .about p{margin:0 0 10px; color:rgba(231,236,255,.62); font-size:13px; line-height:1.55}
    .about ul{margin:10px 0 0; padding:0 0 0 18px; color:rgba(231,236,255,.62); font-size:13px; line-height:1.55}
    .about li{margin:6px 0}

    /* Footer */
    .footer{
      margin-top:22px;
      padding:16px 0 34px;
      color:rgba(231,236,255,.55);
      font-size:12px;
    }
    .footerRow{
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    /* ---------- Modal ---------- */
    .backdrop{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.54);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:100;
      padding: 18px;
    }
    .backdrop.show{display:flex}
    .modal{
      width:min(520px, 100%);
      max-height: min(80svh, 760px);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(16,22,46,.70), rgba(10,14,34,.52));
      backdrop-filter: blur(18px);
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
    }
    .modalHeader{
      padding: 14px 14px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .modalHeader b{font-size:13px}
    .modalBody{
      padding: 14px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }
    .modalBody p{margin:0 0 10px; color:rgba(231,236,255,.62); font-size:13px; line-height:1.5}
    .modalFooter{
      padding: 12px 14px 14px;
      border-top: 1px solid rgba(255,255,255,.08);
      display:flex;
      gap:10px;
      justify-content:flex-end;
      flex-wrap:wrap;
    }

    .field{margin-bottom:12px}
    .field label{display:block; font-size:12px; color:rgba(231,236,255,.68); margin:0 0 6px}
    .input{
      width:100%;
      padding:11px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color:var(--ink);
      outline:none;
    }
    .input:focus{box-shadow: var(--focus); border-color: rgba(90,160,255,.32)}
    .row2{display:grid; grid-template-columns: 1fr 1fr; gap:10px}

    .pwWrap{position:relative}
    .pwToggle{
      position:absolute;
      right:10px;
      top:50%;
      transform: translateY(-50%);
      width:34px;height:34px;
      border-radius: 10px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      display:grid;
      place-items:center;
      cursor:pointer;
    }
    .pwToggle svg{width:16px;height:16px;stroke:rgba(231,236,255,.72);fill:none;stroke-width:2.2}

    .msg{
      margin-top:8px;
      font-size:12px;
      color:rgba(231,236,255,.64);
      min-height: 16px;
    }
    .msg.bad{color: rgba(255,91,106,.9)}
    .msg.good{color: rgba(53,208,127,.9)}

    /* ---------- Pages ---------- */
    .page{display:none}
    .page.show{display:block}

    /* ---------- Responsive ---------- */
    @media (max-width: 980px){
      .heroGrid{grid-template-columns: 1fr; gap:16px}
      .heroCard{display:none}
      .grid4{grid-template-columns: 1fr 1fr}
      .grid3{grid-template-columns: 1fr}
      .twoCol{grid-template-columns: 1fr}
      .brand{min-width:auto}
    }
    @media (max-width: 520px){
      .container{width:min(var(--max), calc(100% - 28px))}
      .grid4{grid-template-columns: 1fr}
      .row2{grid-template-columns: 1fr}
      .iconBubble{width:124px;height:124px}
      .iconBubble svg{width:38px;height:38px}
    }

    /* ---------- Animations ---------- */
    .fadeUp{
      opacity:0;
      transform: translateY(10px);
      animation: fadeUp .75s ease forwards;
    }
    .d1{animation-delay:.06s}
    .d2{animation-delay:.14s}
    .d3{animation-delay:.22s}
    .d4{animation-delay:.30s}
    @keyframes fadeUp{
      to{opacity:1; transform: translateY(0)}
    }

    /* Prevent background scrolling when modal open */
    body.modalOpen{
      overflow:hidden;
      touch-action:none;
    }
  </style>
</head>

<body>
  <!-- NAV -->
  <div class="navwrap" id="navwrap">
    <div class="nav">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <!-- Update path if needed -->
          <img src="SmartCore Official Logos/SC Icon - Black Background.png" alt="SmartCore logo">
        </div>
        <div class="name">
          <strong>SmartCore Technology</strong>
          <span>Practical Technology. Built to Last.</span>
        </div>
      </div>

      <div class="actions">
        <button class="btn ghost" id="navLoginBtn">Log in</button>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <header class="hero" id="hero">
    <!-- Floating icons -->
    <div class="iconsLayer" id="iconsLayer" aria-hidden="true"></div>

    <div class="container">
      <div class="heroGrid">
        <div class="heroCopy">
          <div class="chip fadeUp d1"><span class="dot"></span> Calm systems for real workplaces</div>

          <h1 class="fadeUp d2">
            SmartCore <span class="dim">Technology</span>
          </h1>

          <p class="lead fadeUp d3">
            Reliable software systems for workspace management ‚Äî practical tools that stay clean, consistent, and easy to run.
          </p>

          <div class="heroBtns fadeUp d4">
            <button class="btn primary" id="buildPlanBtn">Build your plan ‚Üí</button>
            <button class="btn" id="employeeSignupBtn">Sign up as an employee</button>
            <button class="btn ghost" id="scrollDownBtn">Scroll down <span class="arrow" aria-hidden="true"></span></button>
          </div>

          <div class="scrollHint">
            <span class="arrow" aria-hidden="true"></span>
            Scroll to build your plan
          </div>
        </div>

        <aside class="heroCard fadeUp d4" aria-hidden="true">
          <h3>Platform preview</h3>
          <p>Simple layouts, clear actions, minimal visual noise.</p>
          <div class="miniStats">
            <div class="mini"><b>Live</b><span>Presence view</span></div>
            <div class="mini"><b>Audit</b><span>Clean records</span></div>
            <div class="mini"><b>Fast</b><span>Kiosk-friendly</span></div>
          </div>
          <div class="note">Choose a company size, select modules, then continue to create your account.</div>
        </aside>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main>
    <!-- PLAN -->
    <section class="section" id="planSection">
      <div class="container">
        <div class="glassPanel" id="planPanel">
          <div class="sectionTitle">
            <div>
              <h2>Build your plan</h2>
              <div style="margin-top:4px; color:rgba(231,236,255,.55); font-size:12px">Choose a company size, then select modules.</div>
            </div>
            <div class="right">Monthly subscription (GBP)</div>
          </div>

          <!-- Company size -->
          <div style="margin-top:14px">
            <div class="sectionTitle" style="margin-bottom:8px">
              <h2>Select your company size</h2>
              <div class="right" id="sizeRight">Select one</div>
            </div>
            <div class="grid4" id="sizeGrid"></div>
          </div>

          <!-- Modules (hidden until size selected) -->
          <div style="margin-top:16px; display:none" id="modulesWrap">
            <div class="sectionTitle" style="margin-bottom:8px">
              <h2>Select your modules</h2>
              <div class="right">Select any</div>
            </div>
            <div class="grid3" id="modulesGrid"></div>
          </div>

          <!-- Sticky total (hidden until size selected) -->
          <div class="totalBar" id="totalBar">
            <div class="totalBarInner">
              <div class="totalLeft">
                <b id="monthlyTotal">¬£0 / month</b>
                <span id="monthlyNote">Select a company size to begin</span>
              </div>
              <div class="totalRight">
                <button class="btn ghost" id="clearBtn">Clear</button>
                <button class="btn primary" id="checkoutBtn">Checkout ‚Üí</button>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- ABOUT -->
    <section class="section">
      <div class="container">
        <div class="glassPanel about">
          <h3>About SmartCore Technology</h3>
          <p>
            SmartCore Technology was built by Finley Hassall, a young founder with a long-standing passion for technology and a strong business mindset.
            Interested in IT from the age of six, Finley always knew he wanted to build a career creating systems that solve real-world problems.
          </p>
          <p>
            Rather than focusing on trends or hype, SmartCore Technology was created with a clear goal: to build practical, reliable systems that businesses can depend on every day.
          </p>
          <p>
            The company was developed with guidance and support from Finley‚Äôs mother, a business owner herself, but every system within SmartCore has been hand-crafted from the ground up by Finley.
            Each feature, workflow, and decision has been designed with real workplaces in mind ‚Äî prioritising clarity, usability, and long-term reliability over unnecessary complexity.
          </p>
          <p>
            SmartCore Technology is not about flashy software. It‚Äôs about building tools that work properly, scale sensibly, and quietly do their job in the background.
          </p>

          <h3 style="margin-top:16px">The SmartCore Technology Approach</h3>
          <p>SmartCore Technology is built on a simple philosophy: technology should make work easier, not more complicated.</p>
          <ul>
            <li>solve a specific, real business problem</li>
            <li>be easy to understand and use</li>
            <li>create clear, auditable records</li>
            <li>scale as organisations grow</li>
            <li>remain reliable over time</li>
          </ul>
          <p style="margin-top:12px">
            Instead of offering one large, bloated platform, SmartCore provides modular systems that companies can choose and combine based on their actual needs.
            This keeps costs fair, reduces complexity, and allows businesses to stay in control of how they operate.
          </p>
          <p>
            SmartCore Technology focuses on the areas that matter most ‚Äî people, safety, and operational clarity ‚Äî delivering tools that support organisations without getting in the way.
          </p>
        </div>

        <div class="footer">
          <div class="footerRow">
            <div>SmartCore Technology ‚Äî Practical Technology. Built to Last.</div>
            <div>Support: support@smartcoretechnology.co.uk</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- LEARN MORE MODAL -->
  <div class="backdrop" id="learnBackdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modalHeader">
        <b id="learnTitle">Module</b>
        <button class="btn ghost" id="learnCloseBtn">Close</button>
      </div>
      <div class="modalBody" id="learnBody">
        <!-- injected -->
      </div>
      <div class="modalFooter">
        <button class="btn ghost" id="learnGotItBtn">Got it</button>
      </div>
    </div>
  </div>

  <!-- SIGNUP / CHECKOUT MODAL (Owner) -->
  <div class="backdrop" id="signupBackdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modalHeader">
        <b id="suTitle">Create account</b>
        <button class="btn ghost" id="suCloseBtn">Close</button>
      </div>

      <div class="modalBody">
        <div id="signupStep1">
          <div class="field">
            <label>Company name</label>
            <input id="suCompany" class="input" placeholder="SmartCore Technology" autocomplete="organization" />
          </div>

          <div class="field">
            <label>Your full name</label>
            <input id="suFullName" class="input" placeholder="Finley Hassall" autocomplete="name" />
          </div>

          <div class="field">
            <label>Email</label>
            <input id="suEmail" class="input" placeholder="you@company.co.uk" autocomplete="email" />
          </div>

          <div class="field">
            <label>Password</label>
            <div class="pwWrap">
              <input id="suPassword" class="input" type="password" placeholder="Min 8 characters" autocomplete="new-password" />
              <button class="pwToggle" id="suPwToggle" type="button" aria-label="Show password">
                <svg viewBox="0 0 24 24"><path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7-10-7-10-7Z"/><path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/></svg>
              </button>
            </div>
          </div>

          <div class="msg" id="suMsg"></div>
        </div>

        <div id="signupStep2" style="display:none">
          <div class="field">
            <label>6-digit code</label>
            <input id="suCode" class="input" inputmode="numeric" placeholder="123456" />
            <div style="margin-top:6px; font-size:12px; color:rgba(231,236,255,.55)">We sent a code to your email.</div>
          </div>
          <div class="msg" id="suMsg2"></div>
        </div>

        <div style="margin-top:10px">
          <button class="btn ghost" id="loginInsteadBtn" style="width:100%">Log in instead</button>
        </div>
      </div>

      <div class="modalFooter">
        <button class="btn ghost" id="suBackBtn" style="display:none">Back</button>
        <button class="btn primary" id="continueBtn">Continue ‚Üí</button>
        <button class="btn primary" id="verifyBtn" style="display:none">Verify + create ‚Üí</button>
      </div>
    </div>
  </div>

  <!-- LOGIN MODAL -->
  <div class="backdrop" id="loginBackdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modalHeader">
        <b>Log in</b>
        <button class="btn ghost" id="loginCloseBtn">Close</button>
      </div>
      <div class="modalBody">
        <div class="field">
          <label>Email</label>
          <input id="liEmail" class="input" autocomplete="email" />
        </div>
        <div class="field">
          <label>Password</label>
          <div class="pwWrap">
            <input id="liPassword" class="input" type="password" autocomplete="current-password" />
            <button class="pwToggle" id="liPwToggle" type="button" aria-label="Show password">
              <svg viewBox="0 0 24 24"><path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7-10-7-10-7Z"/><path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/></svg>
            </button>
          </div>
        </div>
        <div class="msg" id="liMsg"></div>
      </div>
      <div class="modalFooter">
        <button class="btn primary" id="loginBtn">Log in ‚Üí</button>
      </div>
    </div>
  </div>

  <!-- EMPLOYEE SIGNUP MODAL (placeholder UI) -->
  <div class="backdrop" id="empBackdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modalHeader">
        <b>Sign up as an employee</b>
        <button class="btn ghost" id="empCloseBtn">Close</button>
      </div>
      <div class="modalBody">
        <p>Employee signup will use your company ID (e.g. THR624564) and a verification code. We‚Äôll wire this up once owner onboarding is fully stable.</p>
        <div class="msg" id="empMsg"></div>
      </div>
      <div class="modalFooter">
        <button class="btn ghost" id="empOkBtn">OK</button>
      </div>
    </div>
  </div>

  <script>
    /* ================================
       Helpers
    ================================= */
    const $ = (id) => document.getElementById(id);

    function money(n){
      if (n == null) return "";
      return "¬£" + Number(n).toFixed(0);
    }

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    async function apiPost(path, payload){
      const res = await fetch(path, {
        method:"POST",
        headers: {"content-type":"application/json"},
        body: JSON.stringify(payload || {})
      });
      const text = await res.text();
      let data = null;
      try { data = JSON.parse(text); } catch { data = { raw: text }; }
      if (!res.ok) {
        const msg = (data && (data.error || data.message)) ? (data.error || data.message) : text;
        throw new Error(msg || ("Request failed: " + res.status));
      }
      return data;
    }

    function openModal(backdropId){
      const bd = $(backdropId);
      bd.classList.add("show");
      bd.setAttribute("aria-hidden","false");
      document.body.classList.add("modalOpen");
    }
    function closeModal(backdropId){
      const bd = $(backdropId);
      bd.classList.remove("show");
      bd.setAttribute("aria-hidden","true");
      document.body.classList.remove("modalOpen");
    }

    function setMsg(el, text, kind){
      el.textContent = text || "";
      el.classList.remove("bad","good");
      if (kind) el.classList.add(kind);
    }

    /* ================================
       Data
    ================================= */
    const COMPANY_SIZES = [
      { id:"up_to_25", label:"Up to 25 people", price:39, note:"¬£39 / month" },
      { id:"26_100", label:"26‚Äì100 people", price:79, note:"¬£79 / month" },
      { id:"101_250", label:"101‚Äì250 people", price:149, note:"¬£149 / month" },
      { id:"250_plus", label:"250+ people", price:null, note:"Contact us" }
    ];

    const MODULES = [
      {
        id:"presence_fire",
        name:"Presence & Fire Safety",
        price:10,
        summary:"A real-time presence system that shows exactly who is on site at any moment. Staff and visitors sign in and out digitally, creating a live evacuation list that can be used immediately during fire drills or real emergencies.",
        extra:"Designed to be simple, fast, and reliable when it matters most, with clear records for audits and incident reviews.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3",
      },
      {
        id:"policies_handbook",
        name:"Policies & Staff Handbook",
        price:7,
        summary:"A central location for company policies and staff handbooks, with tracking to show who has read and acknowledged each document.",
        extra:"Managers can update policies, request re-acknowledgement, and view clear records at any time. Helps organisations demonstrate that information has been issued and acknowledged without relying on paper or email chains.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3",
      },
      {
        id:"holiday_booking",
        name:"Holiday Booking",
        price:8,
        summary:"A straightforward holiday request and approval system that removes unnecessary back-and-forth.",
        extra:"Staff submit requests, managers approve or decline, and teams can view upcoming absences in one place. Intentionally simple and focused, with no payroll or salary management.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3",
      },
      {
        id:"accident_book",
        name:"Accident & Injury Book",
        price:3,
        summary:"A digital accident and injury reporting system that replaces paper accident books.",
        extra:"Incidents can be logged quickly with notes, photos, and witness details, and records can be exported when required. Keeps incident records organised, secure, and easy to access if they are ever needed.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3",
      },
      {
        id:"training_compliance",
        name:"Training & Compliance",
        price:9,
        summary:"Tracks training expiry dates, compliance requirements, and scheduled checks across the organisation.",
        extra:"Automatic reminders help ensure nothing is missed, from fire drills to equipment inspections and vehicle compliance. Designed to support consistency and oversight without adding unnecessary complexity.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3",
      },
      {
        id:"onboarding_offboarding",
        name:"Onboarding & Offboarding",
        price:8,
        summary:"Structured checklists for new starters and leavers, helping teams complete tasks consistently across departments.",
        extra:"From access setup to equipment returns, nothing is forgotten. Provides a clear record of what was completed and when, supporting smoother staff transitions.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3",
      },
      {
        id:"expenses_upload",
        name:"Expenses Upload",
        price:6,
        summary:"Allows staff to upload receipts digitally with notes and categories, removing the need to collect paper receipts.",
        extra:"Submissions can be reviewed and exported for accounting or payroll systems. Keeps expense handling simple, organised, and traceable.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3",
      },
      {
        id:"wellbeing_check",
        name:"Wellbeing Check",
        price:4,
        summary:"A lightweight wellbeing check-in with three options: üôÇ Positive (green), üòê Neutral (amber), üôÅ Concerned (red).",
        extra:"Over time, this provides managers with a simple, high-level view of wellbeing trends across teams. No medical data, no intrusive questions ‚Äî just a clear, visual pulse check designed to support awareness while respecting privacy.",
        video:"https://youtu.be/S2kymv60ndQ?si=7AGk-tN09k0g5qf3",
      },
    ];

    /* ================================
       State
    ================================= */
    let selectedSizeId = null;
    let selectedModuleIds = new Set();
    let pendingSignup = null;

    /* ================================
       Render: Company size & Modules
    ================================= */
    function renderSizes(){
      const grid = $("sizeGrid");
      grid.innerHTML = "";
      COMPANY_SIZES.forEach(sz => {
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.sizeId = sz.id;

        card.innerHTML = `
          <div class="pickBtn" title="Select">
            <svg viewBox="0 0 24 24"><path d="M20 6 9 17l-5-5"/></svg>
          </div>
          <h4>${sz.label}</h4>
          <div class="price">${sz.note}</div>
          <div class="sub">${sz.id === "250_plus" ? "We‚Äôll quote based on requirements." : "Checkout online in minutes."}</div>
        `;

        card.addEventListener("click", () => {
          if (sz.id === "250_plus"){
            // still allow select, but checkout will show contact message.
            selectedSizeId = sz.id;
          } else {
            selectedSizeId = sz.id;
          }
          // Reset modules on size change
          selectedModuleIds = new Set();
          updateSelectionUI();
          $("modulesWrap").style.display = "block";
          $("totalBar").style.display = "block";
          $("sizeRight").textContent = sz.label;
          scrollIntoPlanIfNeeded();
        });

        grid.appendChild(card);
      });
    }

    function renderModules(){
      const grid = $("modulesGrid");
      grid.innerHTML = "";
      MODULES.forEach(m => {
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.moduleId = m.id;

        // IMPORTANT: no summary text shown here (per your request)
        card.innerHTML = `
          <div class="pickBtn" title="Add/remove">
            <svg viewBox="0 0 24 24"><path d="M20 6 9 17l-5-5"/></svg>
          </div>
          <h4>${m.name}</h4>
          <div class="price">¬£${m.price} / month</div>

          <div class="learnRow">
            <button class="learnBtn" type="button" data-learn="${m.id}">Learn more</button>
            <div class="tick"><strong>Selected</strong> <span class="miniDot" style="width:6px;height:6px;border-radius:99px;background:rgba(90,160,255,.6);display:inline-block"></span></div>
          </div>
        `;

        // Toggle select on card click (but not learn button)
        card.addEventListener("click", (e) => {
          const learn = e.target.closest("[data-learn]");
          if (learn) return;
          if (!selectedSizeId){
            return;
          }
          toggleModule(m.id);
        });

        // Learn more
        card.querySelector("[data-learn]").addEventListener("click", (e) => {
          e.preventDefault();
          e.stopPropagation();
          openLearnMore(m.id);
        });

        grid.appendChild(card);
      });
    }

    function toggleModule(id){
      if (selectedModuleIds.has(id)) selectedModuleIds.delete(id);
      else selectedModuleIds.add(id);
      updateSelectionUI();
    }

    function updateSelectionUI(){
      // sizes
      document.querySelectorAll("[data-size-id]").forEach(el => {
        el.classList.toggle("selected", el.dataset.sizeId === selectedSizeId);
      });

      // modules
      document.querySelectorAll("[data-module-id]").forEach(el => {
        const on = selectedModuleIds.has(el.dataset.moduleId);
        el.classList.toggle("selected", on);
        // "Selected" label more obvious: hide unless selected
        const tick = el.querySelector(".tick");
        if (tick) tick.style.opacity = on ? "1" : "0";
        if (tick) tick.style.transform = on ? "translateY(0)" : "translateY(4px)";
      });

      // totals
      const size = COMPANY_SIZES.find(s => s.id === selectedSizeId);
      let base = size ? (size.price || 0) : 0;
      let mods = 0;
      selectedModuleIds.forEach(mid => {
        const m = MODULES.find(x => x.id === mid);
        if (m) mods += m.price;
      });

      const total = base + mods;

      if (!selectedSizeId){
        $("monthlyTotal").textContent = "¬£0 / month";
        $("monthlyNote").textContent = "Select a company size to begin";
        $("checkoutBtn").disabled = true;
      } else if (selectedSizeId === "250_plus"){
        $("monthlyTotal").textContent = "Custom / month";
        $("monthlyNote").textContent = "250+ people ‚Äî contact us to quote";
        $("checkoutBtn").disabled = false;
      } else {
        $("monthlyTotal").textContent = `¬£${total} / month`;
        const sizeLabel = size?.label || "";
        const modsCount = selectedModuleIds.size;
        $("monthlyNote").textContent = `${sizeLabel} ‚Ä¢ ${modsCount} module${modsCount===1?"":"s"}`;
        $("checkoutBtn").disabled = false;
      }
    }

    function clearAll(){
      selectedSizeId = null;
      selectedModuleIds = new Set();
      $("modulesWrap").style.display = "none";
      $("totalBar").style.display = "none";
      $("sizeRight").textContent = "Select one";
      updateSelectionUI();
    }

    function scrollIntoPlanIfNeeded(){
      const plan = $("planSection");
      plan.scrollIntoView({behavior:"smooth", block:"start"});
    }

    /* ================================
       Learn more modal (scroll-safe)
    ================================= */
    function openLearnMore(moduleId){
      const m = MODULES.find(x => x.id === moduleId);
      if (!m) return;

      $("learnTitle").textContent = m.name;

      const yt = makeYoutubeEmbed(m.video);
      $("learnBody").innerHTML = `
        <div style="display:grid; gap:12px">
          <div style="border:1px solid rgba(255,255,255,.10); border-radius:14px; overflow:hidden; background:rgba(0,0,0,.18)">
            ${yt}
          </div>

          <p><strong style="color:rgba(231,236,255,.86)">¬£${m.price} / month</strong></p>
          <p>${escapeHtml(m.summary)}</p>
          <p>${escapeHtml(m.extra)}</p>
        </div>
      `;

      // open modal and lock scroll properly
      openModal("learnBackdrop");
    }

    function makeYoutubeEmbed(url){
      // Convert youtu.be to embed
      try{
        const u = new URL(url);
        let id = "";
        if (u.hostname.includes("youtu.be")) id = u.pathname.replace("/","");
        if (u.hostname.includes("youtube.com") && u.searchParams.get("v")) id = u.searchParams.get("v");
        const embed = `https://www.youtube.com/embed/${encodeURIComponent(id)}?rel=0&modestbranding=1`;
        return `
          <iframe
            src="${embed}"
            title="Module preview"
            style="width:100%; aspect-ratio:16/9; border:0; display:block"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen"
            allowfullscreen
          ></iframe>
        `;
      }catch{
        return `<div style="padding:14px; color:rgba(231,236,255,.62); font-size:13px">Preview unavailable</div>`;
      }
    }

    function escapeHtml(s){
      return String(s||"").replace(/[&<>"']/g, (c)=>({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[c]));
    }

    /* ================================
       Signup flow (Owner) ‚Äî CODE FIRST, THEN CREATE
    ================================= */
    function openSignup(){
      // Must have size selected to checkout
      if (!selectedSizeId){
        scrollIntoPlanIfNeeded();
        return;
      }
      // step 1 visible
      $("signupStep1").style.display = "block";
      $("signupStep2").style.display = "none";
      $("continueBtn").style.display = "inline-flex";
      $("verifyBtn").style.display = "none";
      $("suBackBtn").style.display = "none";
      setMsg($("suMsg"), "", null);
      setMsg($("suMsg2"), "", null);

      openModal("signupBackdrop");
    }

    function closeSignup(){
      closeModal("signupBackdrop");
      pendingSignup = null;
      $("suCode").value = "";
    }

    async function sendCodeForOwner(){
      const company_name = $("suCompany").value.trim();
      const full_name = $("suFullName").value.trim();
      const email = $("suEmail").value.trim().toLowerCase();
      const password = $("suPassword").value;

      if (!company_name || !full_name || !email || !password){
        setMsg($("suMsg"), "Please fill in company name, your full name, email and password.", "bad");
        return;
      }
      if (password.length < 8){
        setMsg($("suMsg"), "Password must be at least 8 characters.", "bad");
        return;
      }

      // Save pending info (NO Supabase user creation here)
      pendingSignup = {
        company_name,
        full_name,
        email,
        password,
        company_size: selectedSizeId,
        module_ids: Array.from(selectedModuleIds)
      };

      $("continueBtn").disabled = true;
      $("continueBtn").style.opacity = ".6";

      try{
        await apiPost("/api/send-code", { email, purpose:"owner_signup" });
        // Step 2
        $("signupStep1").style.display = "none";
        $("signupStep2").style.display = "block";
        $("continueBtn").style.display = "none";
        $("verifyBtn").style.display = "inline-flex";
        $("suBackBtn").style.display = "inline-flex";
        setMsg($("suMsg2"), "Code sent. Enter it below to create your account.", "good");
      }catch(e){
        setMsg($("suMsg"), e.message || "Failed to send code.", "bad");
      }finally{
        $("continueBtn").disabled = false;
        $("continueBtn").style.opacity = "1";
      }
    }

    async function verifyAndCreateOwner(){
      setMsg($("suMsg2"), "", null);
      if (!pendingSignup){
        setMsg($("suMsg2"), "Press Continue first.", "bad");
        return;
      }
      const code = $("suCode").value.trim();
      if (!code || code.length !== 6){
        setMsg($("suMsg2"), "Enter the 6-digit code.", "bad");
        return;
      }

      $("verifyBtn").disabled = true;
      $("verifyBtn").style.opacity = ".6";

      try{
        // This endpoint should:
        // - verify code (hashed) in signup_codes
        // - create auth user (email+password)
        // - create company + purchases
        // - return ok:true and (optionally) session/user/company
        const data = await apiPost("/api/verify-code", {
          purpose: "owner_signup",
          email: pendingSignup.email,
          code,
          full_name: pendingSignup.full_name,
          password: pendingSignup.password,
          company_name: pendingSignup.company_name,
          company_size: pendingSignup.company_size,
          module_ids: pendingSignup.module_ids
        });

        setMsg($("suMsg2"), "Account created. Redirecting‚Ä¶", "good");
        closeSignup();

        // In testing, just take them to home; dashboard will be wired once verify-code returns session.
        // If your verify-code returns a redirect or dashboard token, handle it here.
        // For now:
        window.location.hash = "#dashboard";
        // If you already have a dashboard route in your current version, it can hook into the hash.
      }catch(e){
        setMsg($("suMsg2"), e.message || "Create failed.", "bad");
      }finally{
        $("verifyBtn").disabled = false;
        $("verifyBtn").style.opacity = "1";
      }
    }

    function signupBack(){
      $("signupStep1").style.display = "block";
      $("signupStep2").style.display = "none";
      $("continueBtn").style.display = "inline-flex";
      $("verifyBtn").style.display = "none";
      $("suBackBtn").style.display = "none";
      $("suCode").value = "";
      setMsg($("suMsg"), "", null);
      setMsg($("suMsg2"), "", null);
    }

    /* ================================
       Login (placeholder)
    ================================= */
    function openLogin(){
      setMsg($("liMsg"), "", null);
      $("liEmail").value = "";
      $("liPassword").value = "";
      openModal("loginBackdrop");
    }
    async function doLogin(){
      setMsg($("liMsg"), "", null);
      const email = $("liEmail").value.trim().toLowerCase();
      const password = $("liPassword").value;
      if (!email || !password){
        setMsg($("liMsg"), "Enter email and password.", "bad");
        return;
      }
      $("loginBtn").disabled = true;
      $("loginBtn").style.opacity = ".6";
      try{
        // If you already created an API endpoint for login, call it here.
        // Otherwise, we‚Äôll keep this as a placeholder so UI doesn‚Äôt break.
        // Example:
        // await apiPost("/api/login", { email, password });
        setMsg($("liMsg"), "Login endpoint not wired yet.", "bad");
      }catch(e){
        setMsg($("liMsg"), e.message || "Login failed.", "bad");
      }finally{
        $("loginBtn").disabled = false;
        $("loginBtn").style.opacity = "1";
      }
    }

    /* ================================
       Nav hide / show on scroll
       - hide when you scroll past hero
       - show when near top
    ================================= */
    function setupNavAutoHide(){
      const navwrap = $("navwrap");
      const hero = $("hero");
      const heroH = () => hero.getBoundingClientRect().height;

      const onScroll = () => {
        const y = window.scrollY || document.documentElement.scrollTop;
        const threshold = Math.max(260, heroH() * 0.78);
        if (y > threshold) navwrap.classList.add("hidden");
        else navwrap.classList.remove("hidden");
      };

      window.addEventListener("scroll", onScroll, {passive:true});
      onScroll();
    }

    /* ================================
       Floating icons (scattered across screen)
       - Ensure none overlap central text area
    ================================= */
    function iconSvg(type){
      // lightweight set (8)
      const svgs = {
        plus:`<svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>`,
        check:`<svg viewBox="0 0 24 24"><path d="M20 6 9 17l-5-5"/></svg>`,
        lock:`<svg viewBox="0 0 24 24"><path d="M7 11V8a5 5 0 0 1 10 0v3"/><path d="M6 11h12v10H6z"/></svg>`,
        list:`<svg viewBox="0 0 24 24"><path d="M8 6h13M8 12h13M8 18h13"/><path d="M3 6h.01M3 12h.01M3 18h.01"/></svg>`,
        target:`<svg viewBox="0 0 24 24"><path d="M12 2v4M12 18v4M2 12h4M18 12h4"/><path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"/></svg>`,
        badge:`<svg viewBox="0 0 24 24"><path d="M12 2 19 6v6c0 5-3.5 8.5-7 10-3.5-1.5-7-5-7-10V6z"/></svg>`,
        brief:`<svg viewBox="0 0 24 24"><path d="M9 6V4h6v2"/><path d="M4 7h16v13H4z"/><path d="M4 12h16"/></svg>`,
        hex:`<svg viewBox="0 0 24 24"><path d="M7 3h10l4 7-4 11H7L3 10z"/><path d="M12 8v8"/></svg>`
      };
      return svgs[type] || svgs.plus;
    }

    function buildIcons(){
      const layer = $("iconsLayer");
      layer.innerHTML = "";

      // Place icons around the hero, scattered (not only edges)
      // Avoid central "safe box" where text sits.
      // Safe zone approx: x 18%..68% and y 12%..62% on desktop. We'll keep icons outside.
      const icons = ["plus","check","lock","list","target","badge","brief","hex"];

      const placements = [
        {x: 8,  y: 18, s: 150, t:"plus"},
        {x: 82, y: 18, s: 140, t:"lock"},
        {x: 10, y: 58, s: 140, t:"check"},
        {x: 86, y: 62, s: 150, t:"brief"},
        {x: 72, y: 40, s: 150, t:"hex"},
        {x: 42, y: 74, s: 160, t:"list"},
        {x: 58, y: 20, s: 135, t:"target"},
        {x: 24, y: 34, s: 135, t:"badge"},
      ];

      placements.forEach(p => {
        const d = document.createElement("div");
        d.className = "iconBubble";
        d.style.left = p.x + "%";
        d.style.top = p.y + "%";
        d.style.width = p.s + "px";
        d.style.height = p.s + "px";
        d.style.transform = "translate(-50%,-50%)";
        d.innerHTML = iconSvg(p.t);
        layer.appendChild(d);
      });

      // On very small screens, reduce overlap by shrinking and nudging
      const applyResponsive = () => {
        const w = window.innerWidth;
        const all = Array.from(layer.querySelectorAll(".iconBubble"));
        if (w < 560){
          all.forEach((b, i) => {
            b.style.width = "118px";
            b.style.height = "118px";
            // keep them scattered but less intrusive
            b.style.opacity = ".12";
          });
        } else {
          all.forEach((b) => b.style.opacity = ".18");
        }
      };

      window.addEventListener("resize", applyResponsive);
      applyResponsive();
    }

    /* ================================
       Password eye toggles
    ================================= */
    function setupPwToggle(inputId, btnId){
      const inp = $(inputId);
      const btn = $(btnId);
      btn.addEventListener("click", () => {
        const isPw = inp.type === "password";
        inp.type = isPw ? "text" : "password";
        btn.setAttribute("aria-label", isPw ? "Hide password" : "Show password");
      });
    }

    /* ================================
       Wire UI
    ================================= */
    function wireUI(){
      // buttons
      $("scrollDownBtn").addEventListener("click", () => scrollIntoPlanIfNeeded());
      $("buildPlanBtn").addEventListener("click", () => scrollIntoPlanIfNeeded());
      $("clearBtn").addEventListener("click", () => clearAll());

      $("checkoutBtn").addEventListener("click", () => openSignup());

      $("navLoginBtn").addEventListener("click", () => openLogin());

      $("employeeSignupBtn").addEventListener("click", () => openModal("empBackdrop"));

      // learn modal close
      $("learnCloseBtn").addEventListener("click", () => closeModal("learnBackdrop"));
      $("learnGotItBtn").addEventListener("click", () => closeModal("learnBackdrop"));
      $("learnBackdrop").addEventListener("click", (e) => {
        if (e.target === $("learnBackdrop")) closeModal("learnBackdrop");
      });

      // signup modal close
      $("suCloseBtn").addEventListener("click", closeSignup);
      $("signupBackdrop").addEventListener("click", (e) => {
        if (e.target === $("signupBackdrop")) closeSignup();
      });
      $("continueBtn").addEventListener("click", sendCodeForOwner);
      $("verifyBtn").addEventListener("click", verifyAndCreateOwner);
      $("suBackBtn").addEventListener("click", signupBack);

      $("loginInsteadBtn").addEventListener("click", () => {
        closeSignup();
        openLogin();
      });

      // login modal
      $("loginCloseBtn").addEventListener("click", () => closeModal("loginBackdrop"));
      $("loginBackdrop").addEventListener("click", (e) => {
        if (e.target === $("loginBackdrop")) closeModal("loginBackdrop");
      });
      $("loginBtn").addEventListener("click", doLogin);

      // employee modal
      $("empCloseBtn").addEventListener("click", () => closeModal("empBackdrop"));
      $("empOkBtn").addEventListener("click", () => closeModal("empBackdrop"));
      $("empBackdrop").addEventListener("click", (e) => {
        if (e.target === $("empBackdrop")) closeModal("empBackdrop");
      });

      // password toggles
      setupPwToggle("suPassword", "suPwToggle");
      setupPwToggle("liPassword", "liPwToggle");
    }

    /* ================================
       Init
    ================================= */
    function init(){
      renderSizes();
      renderModules();
      updateSelectionUI();
      setupNavAutoHide();
      buildIcons();
      wireUI();

      // Initially modules hidden until size selected
      $("modulesWrap").style.display = "none";
      $("totalBar").style.display = "none";

      // If user lands with /api routes in browser, show hint (but won‚Äôt break site)
      // No redirect logic here ‚Äî Cloudflare handles /api via Functions.
    }

    init();
  </script>
</body>
</html>
